{% extends 'base.html' %}
{% block content %}
<div class="page-toolbar">
  <div class="section-nav" aria-label="Parts actions">
    <a class="active" href="/engineering/parts">Parts</a>
  </div>
  <form id="parts-pdf-upload-form" method="post" enctype="multipart/form-data" action="/engineering/parts/upload-pdf" style="display:none;">
    <input type="file" id="parts-pdf-file" name="pdf_file" accept=".pdf,application/pdf" />
  </form>
  <button type="button" id="parts-upload-pdf-btn" class="action-btn">Upload PDF</button>
  <a class="action-btn {% if show_add %}active-tab{% endif %}" href="/engineering/parts?mode=add">Add</a>
</div>

{% if show_add %}
<form class="panel-form" method="post" action="/engineering/parts">
  <div class="form-field"><label>Part ID</label><input name="part_id" required /></div>
  <div class="form-field"><label>Description</label><input name="description" /></div>
  <button type="submit">Save Part</button>
</form>
{% endif %}

<table>
  <tr>
    <th>Part ID</th>
    <th>Description</th>
    <th>Current Rev</th>
    <th>Actions</th>
  </tr>
  {% for part in parts %}
  <tr>
    <td>{{ part.part_id }}</td>
    <td>{{ part.description }}</td>
    <td>{{ part.cur_rev }}</td>
    <td>
      <a href="/engineering/parts/{{ part.part_id }}?mode=view">View</a>
      |
      <a href="/engineering/parts/{{ part.part_id }}?mode=edit">Edit</a>
    </td>
  </tr>
  {% endfor %}
</table>

{% set page_count = ((total_parts + page_size - 1) // page_size) %}
{% if page_count > 1 %}
<div class="action-row">
  {% for p in range(1, page_count + 1) %}
    <a class="action-btn {% if p == page %}active-tab{% endif %}" href="/engineering/parts?page={{ p }}{% if show_add %}&mode=add{% endif %}">{{ p }}</a>
  {% endfor %}
</div>
{% endif %}

<script>
  const uploadPdfBtn = document.getElementById('parts-upload-pdf-btn');
  const uploadPdfInput = document.getElementById('parts-pdf-file');
  const uploadPdfForm = document.getElementById('parts-pdf-upload-form');

  uploadPdfBtn.addEventListener('click', () => {
    uploadPdfInput.click();
  });

  uploadPdfInput.addEventListener('change', () => {
    if (!uploadPdfInput.files || uploadPdfInput.files.length === 0) {
      return;
    }
    uploadPdfForm.submit();
  });
</script>
{% endblock %}
