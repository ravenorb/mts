{% extends 'base.html' %}
{% block content %}

{% if active_tab in ['users','stations','skills','employees'] %}
  {% set entity = active_tab %}
  <div class="page-toolbar">
    <h2>{{active_tab_title}}</h2>
    <a href="/entity/{{entity}}/new" class="action-btn">Add New</a>
  </div>
{% else %}
  <h2>{{active_tab_title}}</h2>
{% endif %}

{% if message %}<div class="ok-banner">{{message}}</div>{% endif %}

{% if active_tab in ['users','stations','skills','employees'] %}
  <table>
    <tr>
      {% for c in admin_cols[entity] %}<th>{{c}}</th>{% endfor %}
      <th>Actions</th>
    </tr>
    {% for r in tab_data[entity] %}
      <tr>
        {% for c in admin_cols[entity] %}<td>{{r|attr(c)}}</td>{% endfor %}
        <td>
          <a href="/entity/{{entity}}/{{r.id}}/edit">Edit</a> |
          <a href="/admin/{{entity}}/{{r.id}}/view">View</a>
          {% if entity == 'stations' %}
          | <a href="/entity/consumables">Consumables</a>
          | <a href="/entity/station_maintenance_tasks">Maintenance Schedule</a>
          | <a href="/entity/maintenance_requests">Maintenance Log</a>
          | <a href="/entity/consumable_usage_logs">Consumable Log</a>
          {% endif %}
          <form method="post" action="/entity/{{entity}}/{{r.id}}/delete" style="display:inline"><button>Delete</button></form>
        </td>
      </tr>
    {% endfor %}
  </table>
{% endif %}

{% if active_tab == 'server-maintenance' %}
  <h3>Server Maintenance</h3>
  <form method="post" action="/admin/server-maintenance" class="panel-form">
    <label>Branch</label>
    <select name="branch">
      {% for branch in branches %}
      <option value="{{branch}}" {% if branch == active_branch %}selected{% endif %}>{{branch}}</option>
      {% endfor %}
    </select>
    <div class="action-row">
      <button type="submit" name="action" value="refresh_branches">Refresh Branch List</button>
      <button type="submit" name="action" value="switch_branch">Switch Branch</button>
      <button type="submit" name="action" value="pull_latest">Pull Latest and Apply</button>
    </div>
    <h4>Data Paths</h4>
    <label>DRAWING_DATA_PATH</label>
    <input name="DRAWING_DATA_PATH" value="{{data_paths.DRAWING_DATA_PATH}}" />
    <label>PDF_DATA_PATH</label>
    <input name="PDF_DATA_PATH" value="{{data_paths.PDF_DATA_PATH}}" />
    <label>PART_FILE_DATA_PATH</label>
    <input name="PART_FILE_DATA_PATH" value="{{data_paths.PART_FILE_DATA_PATH}}" />
    <label>SQL_DATA_PATH (applies on restart)</label>
    <input name="SQL_DATA_PATH" value="{{data_paths.SQL_DATA_PATH}}" />
    <small>Settings persist at {{data_paths.settings_path}}</small>
    <button type="submit" name="action" value="update_paths">Update Data Paths</button>
  </form>
{% endif %}
{% endblock %}
