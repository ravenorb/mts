{% extends 'base.html' %}
{% block content %}
<h2>HK MPF Files</h2>

<table>
  <tr>
    <th>MPF Filename</th>
    <th>Frame Part ID</th>
    <th>Description</th>
    <th>QTY Produced</th>
    <th>Material</th>
    <th>Actions</th>
  </tr>
  {% for row in rows %}
  <tr id="mpf-row-{{row.id}}">
    <td><a href="/engineering/hk-mpfs/{{row.id}}">{{row.mpf_filename}}</a></td>
    <td>{{row.part_id}}</td>
    <td>
      <span class="view-mode">{{row.description}}</span>
      <input class="edit-mode hidden" type="text" name="description" value="{{row.description}}" aria-label="Description" form="mpf-edit-form-{{row.id}}" />
    </td>
    <td>
      <span class="view-mode">{{row.qty_produced}}</span>
      <input class="edit-mode hidden" type="number" step="0.01" name="qty_produced" value="{{row.qty_produced}}" aria-label="QTY Produced" form="mpf-edit-form-{{row.id}}" />
    </td>
    <td>
      <span class="view-mode">{{row.material}}</span>
      <input class="edit-mode hidden" type="text" name="material" value="{{row.material}}" aria-label="Material" form="mpf-edit-form-{{row.id}}" />
    </td>
    <td>
      <form id="mpf-edit-form-{{row.id}}" method="post" action="/engineering/hk-mpfs/{{row.id}}/edit" style="display:inline;">
        <span class="view-mode">
          <a class="small-link" href="#" onclick="return toggleMpfEdit({{row.id}}, true)">edit</a>
          <button type="submit" class="danger-link-btn" formaction="/engineering/hk-mpfs/{{row.id}}/delete" formmethod="post" style="margin-left:0.5rem;">delete</button>
        </span>
        <span class="edit-mode hidden">
          <button type="submit" class="danger-link-btn" style="color:#001f54!important; margin-right:0.5rem;">save</button>
          <a class="small-link" href="#" onclick="return toggleMpfEdit({{row.id}}, false)">cancel</a>
        </span>
      </form>
    </td>
  </tr>
  {% else %}
  <tr><td colspan="6">No parsed HK MPF files available.</td></tr>
  {% endfor %}
</table>

<script>
  function toggleMpfEdit(rowId, editing) {
    const row = document.getElementById(`mpf-row-${rowId}`);
    if (!row) {
      return false;
    }
    row.querySelectorAll('.view-mode').forEach((el) => el.classList.toggle('hidden', editing));
    row.querySelectorAll('.edit-mode').forEach((el) => el.classList.toggle('hidden', !editing));
    return false;
  }
</script>
{% endblock %}
